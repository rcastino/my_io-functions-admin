# Azure DevOps pipeline template used to checkout the code and install all node dependencies. 

parameters:
- name: preDeployBuild
  type: boolean
  default: false
  
steps:
- checkout: self
  displayName: 'Checkout'
      
- task: Cache@2
  inputs:
    key: 'yarn | "$(Agent.OS)" | yarn.lock'
    restoreKeys: |
      yarn | "$(Agent.OS)"
      yarn
    path: $(YARN_CACHE_FOLDER)
  displayName: Cache yarn packages

- script: |
    yarn install --frozen-lockfile --no-progress --non-interactive --network-concurrency 1
  displayName: 'Install node modules'

- ${{ if eq(parameters.preDeployBuild, true) }}:
  - bash: yarn predeploy
    displayName: 'Predeploy build code'

- ${{ if eq(parameters.preDeployBuild, false) }}:
  - bash: yarn build
    displayName: 'Build code'
