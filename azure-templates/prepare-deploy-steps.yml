# Azure DevOps template used to perform all the steps to make the package to deploy. 

parameters:
- name: 'zipFileName'
  default: package.zip
  type: string
  
steps:
- template: ./make-build-steps.yml
  parameters:
    make: predeploy_build

- task: CopyFiles@2
  inputs:
    SourceFolder: '$(System.DefaultWorkingDirectory)'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'
    Contents: |
      **/*
      !.git/**/*
      !**/*.js.map
      !**/*.ts
      !.vscode/**/*
      !azure-templates/**/*
      !azure-pipelines.yml
      !.prettierrc
      !local.settings.json
      !test
      !tsconfig.json
  displayName: 'Copy deploy files' 

- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.ArtifactStagingDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/${{ parameters.zipFileName }}'
  displayName: 'Make deployment zip'
